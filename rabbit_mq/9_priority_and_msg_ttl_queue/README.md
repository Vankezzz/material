# Описание
Пример демонстрирует поведение priority очередей с настроенным для сообщений TTL = 10 секунд.

Сам consumer моделирует задержку в 2 секунды - это нужно, 
чтобы показать как сообщения с 10 приоритетом обрабатываются в первую очередь.

> Настройки в consumer при queue_declare(). 
> Обязательно указывать `x-max-priority` если у нас очередь с приоритетом
```
"x-message-ttl": 10000,  # Время жизни сообщения, в миллисекундах
"x-max-priority": 10,    # Максимальный приоритет для очереди
```
> Также в consumer включена регулировка prefetch=1. 
> Это нужно, чтобы сообщения сразу пачкой не приходили потребителю
```
channel.basic_qos(prefetch_count=1)
``` 

> При отправке сообщения добавляем `priority` в properties в producer.py
```
properties=pika.BasicProperties(
    delivery_mode=pika.spec.PERSISTENT_DELIVERY_MODE,  # сообщение в durable очереди запишется на диск
    priority=10 if i % 10 == 0 else 1
)
```

## Запуск примера
1. Запустить экземпляр consumer 
```shell
python.exe consumer.py
```
2. Запустить producer
```shell
python.exe producer.py
```
3. Отключить consumer, producer отправит пару сообщений в очередь (10 штук)
4. Отключаем резко producer и включаем consumer -
мы должны убедиться что почти все сообщения, которые в очереди были обработались
5. Повторить 1-4 пункт, но только consumer включить через 20 сек на 4 пункте - 
мы увидим, что ни одно сообщение не сохранилось

### Примечание 
Все возможные аргументы объявления queue добавлены в consumer
```
"x-message-ttl": 10000,  # Время жизни сообщения, в миллисекундах
"x-max-priority": 10,    # Максимальный приоритет для очереди
# "x-expires": 10,  # Если очередь не используется указанное тут время, то она удаляется

# Режимы если queue переполнена
# drop-head - удаляем старые сообщения, а новые вставляем в очередь
# reject-publish - запрещаем пушить новые сообщения в очередь
# reject-publish-dlx - запрещаем пушить новые сообщения в очередь, а они попадают в DLQ
# "x-overflow": '',

# Сколько максимум сообщений может держать очередь.
# Остальные автоматически rejected
# "x-max-length": 10,
# Сколько максимум размера в памяти могут потреблять сообщения в очереди.
# Остальные автоматически rejected
# "x-max-length-bytes": 10,

# "x-dead-letter-exchange": "",  # Название exchange, где находится DLQ
# "x-dead-letter-routing-key": "",  # Routing key для DLQ

# "x-queue-type": "",  # Вид очереди classic или quorum
```
